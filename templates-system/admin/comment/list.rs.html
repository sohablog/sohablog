@use super::super::super::statics;
@use super::super::super::base;
@use super::super::super::misc::paginator;
@use crate::models::comment::Comment;
@use crate::models::comment::CommentStatus;
@use crate::routes::Page;
@use crate::render::*;
@use rocket_codegen::*;

@(ctx: &GlobalContext, page: Page, status: CommentStatus, comments: Vec<Comment>)

@:base(ctx, "Comment List", {}, {}, {
	<p>
		<a@if status != CommentStatus::Normal { href="@uri!(crate::routes::admin::comment::list: status = Some(CommentStatus::Normal), page = Some(Page::new(1, 1)))"}>Normal</a>
		&nbsp;
		<a@if status != CommentStatus::Spam { href="@uri!(crate::routes::admin::comment::list: status = Some(CommentStatus::Spam), page = Some(Page::new(1, 1)))"}>Spam</a>
		&nbsp;
		<a@if status != CommentStatus::PendingReview { href="@uri!(crate::routes::admin::comment::list: status = Some(CommentStatus::PendingReview), page = Some(Page::new(1, 1)))"}>PendingReview</a>
		&nbsp;
	</p>
	@for comment in comments {
		<hr />
		<a@if let Some(l) = &comment.author_link { href="@l"}>@comment.author_name</a>@if let Some(i) = &comment.ip {&nbsp;/&nbsp;@i}@if let Some(i) = &comment.author_mail {&nbsp;/&nbsp;@i}@if let Some(i) = &comment.user_agent {&nbsp;/&nbsp;<small>@i</small>}
		<br />
		<span>@comment.time</span>&nbsp;@@<span>@if let Ok(post) = comment.get_content(&ctx.db) {<a href="@post.get_link()">@if let Some(t) = &post.title {@t} else {Untitled}</a>}</span>
		<br />
		<p>@comment.text</p>
		<table class="set-status-buttons" data-id="@comment.id">
			<tr>
				<td><b>Mark as</b></td>
				<td><button data-status="@CommentStatus::Normal"@if comment.status == CommentStatus::Normal { disabled}>Normal</button></td>
				<td><button data-status="@CommentStatus::Spam"@if comment.status == CommentStatus::Spam { disabled}>Spam</button></td>
				<td><button data-status="@CommentStatus::PendingReview"@if comment.status == CommentStatus::PendingReview { disabled}>PendingReview</button></td>
				<td><button data-status="@CommentStatus::Deleted"@if comment.status == CommentStatus::Deleted { disabled}>Deleted</button></td>
			</tr>
		</table>
	}
	<hr />
	@:paginator(page)
}, {
	<script src="/static/system/@statics::jquery_3_4_1_min_js.name"></script>
	<script src="/static/system/@statics::admin_comment_js.name"></script>
	<script>
		window.__injectData = @{
			token: "@ctx.session_info.csrf_token.as_str()",
			tokenFieldName: "@ctx.system_config.csrf_field_name",
			setStatusUrl: "@uri!(crate::routes::admin::comment::set_status: id = -20001003, status = -20000309)"
		@};
	</script>
})
