@use super::super::super::statics;
@use super::super::super::base;
@use crate::models::content::Content;
@use crate::models::content::ContentStatus;
@use crate::models::category::Category;
@use crate::render::*;
@use rocket_codegen::*;
@use chrono::prelude::Utc;

@(ctx: &GlobalContext, title: &str, post: Option<Content>, categories: Vec<Category>)

@:base(ctx, title, {}, {
	<link href="/static/system/@statics::markdown_palettes_0_4_11_css.name" rel="stylesheet" />
}, {
	<form action="@uri!(crate::routes::admin::post::edit_post)" method="POST">
		@if let Some(p) = &post {<input type="hidden" name="id" value="@p.id" />}
		<input type="text" placeholder="Title" name="title" @if let Some(p) = &post {@if let Some(t) = &p.title {value="@t" }}/>
		<br />
		<input type="text" placeholder="Slug" name="slug" @if let Some(p) = &post {@if let Some(t) = &p.slug {value="@t" }}/>
		<br />
		<div style="height: 600px;">
			<div id="content-mp"></div>
		</div>
		<textarea style="display: none;" id="content" name="content">@if let Some(p) = &post {@p.content}</textarea>
		<br />
		<p><b>Category</b></p>
		<p>
			<input type="radio" name="category" value="" @if let Some(p) = &post {@if let None = p.category {checked }} else {checked }/>&nbsp;Uncategorized <br />@for cat in categories {
			<input type="radio" name="category" value="@cat.id" @if let Some(p) = &post {@if let Some(cid) = p.category {@if cid == cat.id {checked }}}/>&nbsp;@cat.name <br />}
		</p>
		<br />
		<input type="text" placeholder="Time" name="time" value="@if let Some(p) = &post {@p.time} else {@date_format(&Utc::now().naive_local(), "%Y-%m-%d %H:%M:%S")}" />
		<br />
		<input type="text" placeholder="Tags (split with comma)" name="tags" @if let Some(p) = &post {value="@(p.get_tags_name(&ctx.db).unwrap().join(", "))" }/>
		<br />
		<select name="status">
			<option value="@ContentStatus::Unpublished"@if let Some(p) = &post {@if p.status == ContentStatus::Unpublished { selected}}>Unpublished</option>
			<option value="@ContentStatus::Normal"@if let Some(p) = &post {@if p.status == ContentStatus::Normal { selected}} else { selected}>Normal</option>
			<option value="@ContentStatus::Hidden"@if let Some(p) = &post {@if p.status == ContentStatus::Hidden { selected}}>Hidden</option>
			<option value="@ContentStatus::WithAccessOnly"@if let Some(p) = &post {@if p.status == ContentStatus::WithAccessOnly { selected}}>Only with Access</option>
		</select>
		<br />
		<input type="hidden" id="save_draft" name="save_draft" value="true" />
		<input type="submit" id="submit_draft" value="Draft" />
		<input type="submit" id="submit" value="Save" />
	</form>
}, {
	<script src="/static/system/@statics::jquery_3_4_1_min_js.name"></script>
	<script src="/static/system/@statics::markdown_palettes_0_4_11_min_js.name"></script>
	<script src="/static/system/@statics::admin_post_edit_js.name"></script>
})
